<div class="col-sm-12">
  <div class='row'>
    <div class="col-sm-1">
      <a href='#' class='js-prevRecipe' data-recipe-id='<%=@recipe.id%>'>&lt;Previous&gt;</a>
    </div>
    <input type='hidden' class='js-currRecipe' value='<%=@recipe.id%>'>
    <div class="col-sm-1">
      <a href='#' class='js-nextRecipe' data-recipe-id='<%=@recipe.id%>'>&lt;Next&gt;</a>
    </div>
  </div>
  <div class='row recipe-detail'>
    <div class="col-sm-12">
      <h1>
        <%= @recipe.name %> <%= link_to image_tag('edit-icon.png', size:'16', title: 'Edit recipe'), edit_recipe_path(@recipe) if @recipe.author == current_user %>
        <%= link_to image_tag('delete-icon.png', size:'16', title: 'Delete recipe'), recipe_path(@recipe), method: :delete, data: {confirm: 'Are you sure!'} if policy(@recipe).destroy? %>
      </h1>
      <p>Submitted by <%= link_to @recipe.author_name, user_recipes_path(@recipe.author) %></p>
      <p>
        <%= image_tag(@recipe.photo_path, size: '360x200', alt: '#{@recipe.name} photo', title: 'recipe photo' ) %>
        <%= render partial: 'recipes/favorite', locals: {recipe: @recipe} %>
      </p>
      <p style='width:40%' align='justify'><%= @recipe.description %></p>
      <p>Total time: <%= pluralize(number_with_precision(@recipe.total_time, precision: 0), 'minute') %></p>
      <p>
        <% if @recipe.recipe_ingredients.length > 0 %>
          <a href='#' class='js-ingredients' data-recipe-id='<%=@recipe.id%>' data-show-detail='1'>Ingredients</a>
        <% else %>
          Ingredients
        <% end %>
        (<%= @recipe.recipe_ingredients.length %>)
      </p>
      <p id='ingredients'></p>
      <p>
        <% if @recipe.recipe_steps.length > 0 %>
          <a href='#' class='js-steps' data-recipe-id='<%=@recipe.id%>' data-show-detail='1'>Steps</a>
        <% else %>
          Steps
        <% end %>
        (<%= @recipe.recipe_steps.length %>)
      </p>
      <p id='steps'></p>
      <p>
        <% if @recipe.recipe_reviews.length > 0 %>
          <%= link_to 'Reviews', recipe_recipe_reviews_path(@recipe) %>
        <% else %>
          Reviews
        <% end %>
        (<%= @recipe.recipe_reviews.length %>)
      </p>
      <p id='reviews'>
        <%= render partial: 'recipe_reviews/index', locals: {recipe_reviews: @recipe.recipe_reviews, recipe_id: @recipe.id} %>
      </p>
    </div>
  </div>
</div>

<script id="ingredients-template" type="text/x-handlebars-template">
  {{#each this}}
  <div class='row'>
    <div class='col-sm-2'>{{ingredient}}</div>
    <div class='col-sm-1'>{{quantity}}</div>
    <div class='col-sm-1'>{{unit}}</div>
  </div>
  {{/each}}
</script>

<script id="recipe-template" type="text/x-handlebars-template">
  <div class="col-sm-12">
    <input type='hidden' class='js-currRecipe' value='{{recipe_id}}'>
    <h1>
      {{name}}
      {{{editRecipe recipe_id author_id}}}
    </h1>
    <p>Submitted by <a href='/users/{{user_id}}/recipes'>{{author_name}}</a></p>
    <p>
      <img src='/assets/{{photo_path}}' height='200' width='360' title="{{name}} photo">
    </p>
    <p style='width:40%' align='justify'>{{description}}</p>
    <p>Total time: {{total_time}}</p>
  </div>
</script>

<script id="steps-template" type="text/x-handlebars-template">
  {{#each this}}
  <div class='row'>
    <div class='col-sm-1'>{{step_number}}</div>
    <div class='col-sm-4'>{{description}}</div>
  </div>
  {{/each}}
</script>

<script type='text/javascript' charset='utf-8'>
$(function () {
  $('.js-deleteRecipe').on('click', function(e) {
    deleteRecipe(e);
  });

  $('.js-ingredients').on('click', function(e) {
    showIngredients(e);
  });

  $('.js-nextRecipe').on('click', function(e) {
    navigateRecipe(e, 'next');
  });

  $('.js-prevRecipe').on('click', function(e) {
    navigateRecipe(e, 'prev');
  });

  $('.js-steps').on('click', function(e) {
    showSteps(e);
  });

  Handlebars.registerHelper('editRecipe', function(recipe_id, author_id) {
    var author_user_id = parseInt(Handlebars.escapeExpression(author_id));
    var this_user_id = $('body').data('userid');
    if (author_user_id == this_user_id) {
      return new Handlebars.SafeString(
        '<a href="/recipes/' + recipe_id + '/edit"><img src="/assets/edit-icon.png" height="16" width="16" title="Edit recipe"></a> ' +
        '<a class="js-deleteRecipe" href="#"><img src="/assets/delete-icon.png" height="16" width="16" title="Delete recipe"></a>');
    }
  });
});
</script>
